(function(a){a.fn.bonsai=function(d){var c=arguments;return this.each(function(){var e=a(this).data("bonsai");if(!e){e=new b(this,d);a(this).data("bonsai",e)}if(typeof d=="string"){var f=d;return e[f].apply(e,[].slice.call(c,1))}})};a.bonsai={};a.bonsai.defaults={expandAll:false,expand:null,collapse:null,addExpandAll:false,addSelectAll:false,selectAllExclude:null,idAttribute:"id",createInputs:false,checkboxes:false,handleDuplicateCheckboxes:false,createRadioButtons:false};var b=function(e,d){var c=this;d=d||{};this.options=a.extend({},a.bonsai.defaults,d);this.el=a(e).addClass("bonsai").data("bonsai",this);if(!this.options.scope){this.options.scope=this.el}this.update();if(this.isRootNode()){if(this.options.createCheckboxes){this.createInputs="checkbox"}if(this.options.handleDuplicateCheckboxes){this.handleDuplicateCheckboxes()}if(this.options.checkboxes){this.el.qubit(this.options)}if(this.options.addExpandAll){this.addExpandAllLink()}if(this.options.addSelectAll){this.addSelectAllLink()}this.el.on("click",".thumb",function(f){c.toggle(a(f.currentTarget).closest("li"))})}if(this.options.expandAll){this.expandAll()}};b.prototype={isRootNode:function(){return this.options.scope==this.el},listItem:function(c){if(typeof c==="object"){return a(c)}return this.el.find("["+this.options.idAttribute+'="'+c+'"]')},toggle:function(c){if(!a(c).hasClass("expanded")){return this.expand(c)}else{return this.collapse(c)}},expand:function(c){return this.setExpanded(c,true)},collapse:function(c){return this.setExpanded(c,false)},setExpanded:function(e,d){var f=this.listItem(e);if(f.length>1){var c=this;f.each(function(){c.setExpanded(this,d)});return}if(d){if(!f.data("subList")){return}f=a(f).addClass("expanded").removeClass("collapsed");a(f.data("subList")).css("height","auto")}else{f=a(f).addClass("collapsed").removeClass("expanded");a(f.data("subList")).height(0)}return f},expandAll:function(){this.expand(this.el.find("li"))},collapseAll:function(){this.collapse(this.el.find("li"))},expandTo:function(d){var c=this;var e=this.listItem(d);e.parents("li").each(function(){c.expand(a(this))});return e},update:function(){var c=this;this.el.children().each(function(){var f=a(this);if(c.options.createInputs){c.insertInput(f)}if(f.children().filter(".thumb").length==0){var e=a('<div class="thumb"></div>');f.prepend(e)}var d=f.children().filter("ol, ul");f.toggleClass("has-children",d.find("li").length>0);d.each(function(){if(a("li",this).length==0){return}f.data("subList",this);if(f.hasClass("expanded")){c.expand(f)}else{c.collapse(f)}var g=!!a(this).data("bonsai");a(this).bonsai(g?"update":c.options)})});this.expand=this.options.expand||this.expand;this.collapse=this.options.collapse||this.collapse},serialize:function(){var c=this.options.idAttribute;return this.el.find("li").toArray().reduce(function(f,d){var h=a(d);var g=h.attr(c);if(g){var e=h.hasClass("expanded")?"expanded":(h.hasClass("collapsed")?"collapsed":null);if(e){f[h.hasClass("expanded")?"expanded":"collapsed"].push(g)}}return f},{expanded:[],collapsed:[],version:2})},restore:function(d){var c=this;if(d.version>1){d.expanded.map(this.expand.bind(this));d.collapsed.map(this.collapse.bind(this))}else{Object.keys(d).forEach(function(e){c.setExpanded(e,d[e]==="expanded")})}},insertInput:function(e){var d=this.options.createInputs;if(e.find("> input[type="+d+"]").length){return}var h=this.inputIdFor(e);var f=a('<input type="'+d+'" name="'+this.inputNameFor(e)+'" id="'+h+'" /> ');var c=e.children();var g=e.contents().filter(function(){return this.nodeType==3}).first();f.val(e.data("value"));f.prop("checked",e.data("checked"));c.detach();e.append(f).append(a('<label for="'+h+'">').append(g.length>0?g:c.first())).append(g.length>0?c:c.slice(1))},checkboxPrefix:"bonsai-checkbox-",inputIdFor:function(c){var d=a(c).data("id");while(!d||(a("#"+d).length>0)){d=this.checkboxPrefix+b.uniqueId++}return d},inputNameFor:function(c){return c.data("name")||c.parents().filter("[data-name]").data("name")},handleDuplicateCheckboxes:function(){var c=this;c.el.on("change","input[type=checkbox]",function(e){var f=a(e.target);if(!f.val()){return}var d='input[type=checkbox][value="'+f.val()+'"]'+(f.attr("name")?'[name="'+f.attr("name")+'"]':"")+(f.prop("checked")?":not(:checked)":":checked");c.el.find(d).prop({checked:f.prop("checked"),indeterminate:f.prop("indeterminate")}).trigger("change")})},addExpandAllLink:function(){var c=this;a('<div class="expand-all">').append(a('<a class="all">Expand all</a>').on("click",function(){c.expandAll()})).append('<i class="separator"></i>').append(a('<a class="none">Collapse all</a>').on("click",function(){c.collapseAll()})).insertBefore(this.el)},addSelectAllLink:function(){var e=this.options.scope;var d=this;function c(){return e.find("li").filter(d.options.selectAllExclude||function(){return a(this).css("display")!="none"}).find("> input[type=checkbox]")}a('<div class="check-all">').append(a('<a class="all">Select all</a>').css("cursor","pointer").on("click",function(){c().prop({checked:true,indeterminate:false})})).append('<i class="separator"></i>').append(a('<a class="none">Select none</a>').css("cursor","pointer").on("click",function(){c().prop({checked:false,indeterminate:false})})).insertAfter(this.el)},setCheckedValues:function(c){var d=this.options.scope.find("input[type=checkbox]");a.each(c,function(e,f){d.filter('[value="'+f+'"]').prop("checked",true).trigger("change")})}};a.extend(b,{uniqueId:0})}(jQuery));!function(c,f,a,e){var g,i={drag:true,drop:true,exclude:"",nested:true,vertical:true},o={afterMove:function(t,d,u){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",bodyClass:"dragging",draggedClass:"dragged",isValidTarget:function(t,d){return true},onCancel:function(t,d,v,u){},onDrag:function(t,d,v,u){t.css(d)},onDragStart:function(t,d,v,u){t.css({height:t.outerHeight(),width:t.outerWidth()});t.addClass(d.group.options.draggedClass);c("body").addClass(d.group.options.bodyClass)},onDrop:function(t,d,v,u){t.removeClass(d.group.options.draggedClass).removeAttr("style");c("body").removeClass(d.group.options.bodyClass)},onMousedown:function(d,u,t){if(!t.target.nodeName.match(/^(input|select|textarea)$/i)){t.preventDefault();return true}},placeholderClass:"placeholder",placeholder:'<li class="placeholder"></li>',pullPlaceholder:true,serialize:function(v,u,t){var d=c.extend({},v.data());if(t){return[u]}else{if(u[0]){d.children=u}}delete d.subContainers;delete d.sortable;return d},tolerance:0},q={},l=0,h={left:0,top:0,bottom:0,right:0},g={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},s="subContainers";function r(u,t){var d=Math.max(0,u[0]-t[0],t[0]-u[1]),v=Math.max(0,u[2]-t[1],t[1]-u[3]);return d+v}function n(z,x,t,v){var u=z.length,d=v?"offset":"position";t=t||0;while(u--){var w=z[u].el?z[u].el:c(z[u]),y=w[d]();y.left+=parseInt(w.css("margin-left"),10);y.top+=parseInt(w.css("margin-top"),10);x[u]=[y.left-t,y.left+w.outerWidth()+t,y.top-t,y.top+w.outerHeight()+t]}}function b(u,d){var t=d.offset();return{left:u.left-t.left,top:u.top-t.top}}function p(v,x,u){x=[x.left,x.top];u=u&&[u.left,u.top];var w,t=v.length,d=[];while(t--){w=v[t];d[t]=[t,r(w,x),u&&r(w,u)]}d=d.sort(function(z,y){return y[1]-z[1]||y[2]-z[2]||y[0]-z[0]});return d}function m(d){this.options=c.extend({},o,d);this.containers=[];if(!this.options.rootGroup){this.scrollProxy=c.proxy(this.scroll,this);this.dragProxy=c.proxy(this.drag,this);this.dropProxy=c.proxy(this.drop,this);this.placeholder=c(this.options.placeholder);if(!d.isValidTarget){this.options.isValidTarget=e}}}m.get=function(d){if(!q[d.group]){if(d.group===e){d.group=l++}q[d.group]=new m(d)}return q[d.group]};m.prototype={dragInit:function(u,t){this.$document=c(t.el[0].ownerDocument);var d=c(u.target).closest(this.options.itemSelector);if(d.length){this.item=d;this.itemContainer=t;if(this.item.is(this.options.exclude)||!this.options.onMousedown(this.item,o.onMousedown,u)){return}this.setPointer(u);this.toggleListeners("on");this.setupDelayTimer();this.dragInitDone=true}},drag:function(w){if(!this.dragging){if(!this.distanceMet(w)||!this.delayMet){return}this.options.onDragStart(this.item,this.itemContainer,o.onDragStart,w);this.item.before(this.placeholder);this.dragging=true}this.setPointer(w);this.options.onDrag(this.item,b(this.pointer,this.item.offsetParent()),o.onDrag,w);var v=this.getPointer(w),u=this.sameResultBox,d=this.options.tolerance;if(!u||u.top-d>v.top||u.bottom+d<v.top||u.left-d>v.left||u.right+d<v.left){if(!this.searchValidTarget()){this.placeholder.detach();this.lastAppendedItem=e}}},drop:function(d){this.toggleListeners("off");this.dragInitDone=false;if(this.dragging){if(this.placeholder.closest("html")[0]){this.placeholder.before(this.item).detach()}else{this.options.onCancel(this.item,this.itemContainer,o.onCancel,d)}this.options.onDrop(this.item,this.getContainer(this.item),o.onDrop,d);this.clearDimensions();this.clearOffsetParent();this.lastAppendedItem=this.sameResultBox=e;this.dragging=false}},searchValidTarget:function(y,w){if(!y){y=this.relativePointer||this.pointer;w=this.lastRelativePointer||this.lastPointer}var t=p(this.getContainerDimensions(),y,w),v=t.length;while(v--){var u=t[v][0],z=t[v][1];if(!z||this.options.pullPlaceholder){var d=this.containers[u];if(!d.disabled){if(!this.$getOffsetParent()){var x=d.getItemOffsetParent();y=b(y,x);w=b(w,x)}if(d.searchValidTarget(y,w)){return true}}}}if(this.sameResultBox){this.sameResultBox=e}},movePlaceholder:function(t,u,w,d){var v=this.lastAppendedItem;if(!d&&v&&v[0]===u[0]){return}u[w](this.placeholder);this.lastAppendedItem=u;this.sameResultBox=d;this.options.afterMove(this.placeholder,t,u)},getContainerDimensions:function(){if(!this.containerDimensions){n(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent())}return this.containerDimensions},getContainer:function(d){return d.closest(this.options.containerSelector).data(a)},$getOffsetParent:function(){if(this.offsetParent===e){var d=this.containers.length-1,t=this.containers[d].getItemOffsetParent();if(!this.options.rootGroup){while(d--){if(t[0]!=this.containers[d].getItemOffsetParent()[0]){t=false;break}}}this.offsetParent=t}return this.offsetParent},setPointer:function(t){var u=this.getPointer(t);if(this.$getOffsetParent()){var d=b(u,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer;this.relativePointer=d}this.lastPointer=this.pointer;this.pointer=u},distanceMet:function(d){var t=this.getPointer(d);return(Math.max(Math.abs(this.pointer.left-t.left),Math.abs(this.pointer.top-t.top))>=this.options.distance)},getPointer:function(d){var t=d.originalEvent||d.originalEvent.touches&&d.originalEvent.touches[0];return{left:d.pageX||t.pageX,top:d.pageY||t.pageY}},setupDelayTimer:function(){var d=this;this.delayMet=!this.options.delay;if(!this.delayMet){clearTimeout(this._mouseDelayTimer);this._mouseDelayTimer=setTimeout(function(){d.delayMet=true},this.options.delay)}},scroll:function(d){this.clearDimensions();this.clearOffsetParent()},toggleListeners:function(u){var t=this,d=["drag","drop","scroll"];c.each(d,function(v,w){t.$document[u](g[w],t[w+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=e},clearDimensions:function(){this.traverse(function(d){d._clearDimensions()})},traverse:function(t){t(this);var d=this.containers.length;while(d--){this.containers[d].traverse(t)}},_clearDimensions:function(){this.containerDimensions=e},_destroy:function(){q[this.options.group]=e}};function j(u,t){this.el=u;this.options=c.extend({},i,t);this.group=m.get(this.options);this.rootGroup=this.options.rootGroup||this.group;this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var d=this.rootGroup.options.itemPath;this.target=d?this.el.find(d):this.el;this.target.on(g.start,this.handle,c.proxy(this.dragInit,this));if(this.options.drop){this.group.containers.push(this)}}j.prototype={dragInit:function(t){var d=this.rootGroup;if(!this.disabled&&!d.dragInitDone&&this.options.drag&&this.isValidDrag(t)){d.dragInit(t,this)}},isValidDrag:function(d){return d.which==1||d.type=="touchstart"&&d.originalEvent.touches.length==1},searchValidTarget:function(d,u){var x=p(this.getItemDimensions(),d,u),v=x.length,y=this.rootGroup,z=!y.options.isValidTarget||y.options.isValidTarget(y.item,this);if(!v&&z){y.movePlaceholder(this,this.target,"append");return true}else{while(v--){var w=x[v][0],t=x[v][1];if(!t&&this.hasChildGroup(w)){var A=this.getContainerGroup(w).searchValidTarget(d,u);if(A){return true}}else{if(z){this.movePlaceholder(w,d);return true}}}}},movePlaceholder:function(A,t){var E=c(this.items[A]),z=this.itemDimensions[A],d="after",u=E.outerWidth(),D=E.outerHeight(),y=E.offset(),v={left:y.left,right:y.left+u,top:y.top,bottom:y.top+D};if(this.options.vertical){var C=(z[2]+z[3])/2,B=t.top<=C;if(B){d="before";v.bottom-=D/2}else{v.top+=D/2}}else{var w=(z[0]+z[1])/2,x=t.left<=w;if(x){d="before";v.right-=u/2}else{v.left+=u/2}}if(this.hasChildGroup(A)){v=h}this.rootGroup.movePlaceholder(this,E,d,v)},getItemDimensions:function(){if(!this.itemDimensions){this.items=this.$getChildren(this.el,"item").filter(":not(."+this.group.options.placeholderClass+", ."+this.group.options.draggedClass+")").get();n(this.items,this.itemDimensions=[],this.options.tolerance)}return this.itemDimensions},getItemOffsetParent:function(){var t,d=this.el;if(d.css("position")==="relative"||d.css("position")==="absolute"||d.css("position")==="fixed"){t=d}else{t=d.offsetParent()}return t},hasChildGroup:function(d){return this.options.nested&&this.getContainerGroup(d)},getContainerGroup:function(u){var v=c.data(this.items[u],s);if(v===e){var t=this.$getChildren(this.items[u],"container");v=false;if(t[0]){var d=c.extend({},this.options,{rootGroup:this.rootGroup,group:l++});v=t[a](d).data(a).group}c.data(this.items[u],s,v)}return v},$getChildren:function(v,u){var t=this.rootGroup.options,w=t[u+"Path"],d=t[u+"Selector"];v=c(v);if(w){v=v.find(w)}return v.children(d)},_serialize:function(v,u){var w=this,d=u?"item":"container",t=this.$getChildren(v,d).not(this.options.exclude).map(function(){return w._serialize(c(this),!u)}).get();return this.rootGroup.options.serialize(v,t,u)},traverse:function(d){c.each(this.items||[],function(t){var u=c.data(this,s);if(u){u.traverse(d)}});d(this)},_clearDimensions:function(){this.itemDimensions=e},_destroy:function(){var d=this;this.target.off(g.start,this.handle);this.el.removeData(a);if(this.options.drop){this.group.containers=c.grep(this.group.containers,function(t){return t!=d})}c.each(this.items||[],function(){c.removeData(this,s)})}};var k={enable:function(){this.traverse(function(d){d.disabled=false})},disable:function(){this.traverse(function(d){d.disabled=true})},serialize:function(){return this._serialize(this.el,true)},refresh:function(){this.traverse(function(d){d._clearDimensions()})},destroy:function(){this.traverse(function(d){d._destroy()})}};c.extend(j.prototype,k);c.fn[a]=function(d){var t=Array.prototype.slice.call(arguments,1);return this.map(function(){var v=c(this),u=v.data(a);if(u&&k[d]){return k[d].apply(u,t)||this}else{if(!u&&(d===e||typeof d==="object")){v.data(a,new j(v,d))}}return this})}}(jQuery,window,"sortable");