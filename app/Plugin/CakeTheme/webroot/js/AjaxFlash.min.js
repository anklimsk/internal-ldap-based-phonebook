(function(a,b){if(typeof define==="function"&&define.amd){define(b)}else{if(typeof exports==="object"){module.exports=b()}else{a.AjaxFlashMessage=b()}}})(this,function(){var e={};var h="/cake_theme/flash/flashmsg.json";var f="/cake_theme/flash/flashcfg.json";var d={timeOut:30,theme:"mint",layout:"top",open:"animated flipInX",close:"animated flipOutX",delayDeleteFlash:5,globalAjaxComplete:false};var g=null;function b(){if(g){return true}return false}function a(m,j,s){var n=true;var t="";var q="alert-info";var u="flash-information";var r="glyphicon-info-sign";var o="alert";var p=false;var v="";var k=null;var l=[];$.each(m,function(x,w){if(!w.result||!w.key||!w.messages){return}$.each(w.messages,function(z,A){if(!A.message){return}switch(A.element){case"Flash/success":q="alert-success";u="flash-success";r="glyphicon-ok";o="success";p=(d.timeOut*1000);break;case"Flash/notification":q="alert-info";u="flash-information";r="glyphicon-info-sign";o="alert";p=(d.timeOut*1000);break;case"Flash/error":q="alert-danger";u="flash-error";r="glyphicon-warning-sign";o="error";break;case"Flash/warning":q="alert-warning";u="flash-warning";r="glyphicon-exclamation-sign";o="warning";break;case"Flash/information":default:q="alert-info";u="flash-information";r="glyphicon-info-sign";o="information";p=(d.timeOut*1000);break}n=!A.params.hideMsgIcon;v=A.message;t="";if(n){t='<span class="glyphicon '+r+'"></span>'}if(A.params.code){v='<strong class="ajax-flash-msg-code"><samp>'+A.params.code+"</strong></samp>"+v}if(typeof Noty==="undefined"){if(typeof $().modal==="function"){k=$('<div class="alert '+q+' alert-dismissible fade in ajax-flash-body" role="alert">                                            <div class="ajax-flash-icon">'+t+'</div>                                            <div class="ajax-flash-msg">                                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">                                                    <span aria-hidden="true">&times;</span>                                                </button>'+v+"</div>                                        </div>");if($("#content .breadcrumb").length>0){k.insertAfter("#content .breadcrumb:eq(0)")}else{$("#content").prepend(k)}}else{$("#content").prepend('<div class="ajax-flash-body flash '+u+'">                                            <div class="ajax-flash-icon">'+t+'</div>                                            <div class="ajax-flash-msg">'+v+"</div>                                        </div>");$(".ajax-flash-body").off("click.AjaxFlash").on("click.AjaxFlash",function(){$(this).fadeOut(400)})}$("html, body").animate({scrollTop:0},800)}else{var B='<div class="ajax-flash-body'+u+'">                                    <div class="ajax-flash-icon">'+t+'</div>                                    <div class="ajax-flash-msg">'+v+"</div>                                </div>";var y=new Noty({text:B,type:o,timeout:p,closeWith:["click"],layout:d.layout,theme:d.theme,animation:{open:d.open,close:d.close}}).show()}});l.push(w.key)});if(l.length>0){if(d.delayDeleteFlash<1){d.delayDeleteFlash=5}var i=(d.delayDeleteFlash*1000);setTimeout(c,i,l)}}function c(j){if(!j||!$.isArray(j)||(j.length===0)){return}var i={data:{keys:j,"delete":1}};$.ajax({async:true,url:h,data:i,dataType:"json",global:false,method:"POST"})}e.initStorage=function(){if(typeof Storages==="undefined"){return false}g=Storages.initNamespaceStorage("ajax_flash").sessionStorage;return true};e.initSettings=function(){var j="Config";if(b()&&g.isSet(j)){var i=g.get(j);if(i){d=i;return}}$.ajax({async:false,url:f,dataType:"json",global:false,method:"POST",success:function(k){if(k){d=$.extend({},d,k)}if(b()){g.set(j,d)}}})};e.callbackAjaxFlashMessage=function(i,j){if(j!=="success"){return}if(!i.responseText){return}if(i.responseJSON||i.responseXML){return}if(/<[a-z][\s\S]*>/i.test(i.responseText)){e.ajaxFlashMessage()}};e.registerGlobalAjaxComplete=function(){if(!d.globalAjaxComplete){return}$.ajaxSetup({complete:function(i,j){callbackAjaxFlashMessage(i,j)}})};e.ajaxFlashMessage=function(){var j=d.flashKeys;var k=[];if(!j||!$.isArray(j)||(j.length===0)){return}var i={data:{keys:j,"delete":0}};$.ajax({async:true,url:h,data:i,dataType:"json",global:false,method:"POST",success:a})};return e});$(function(){AjaxFlashMessage.initStorage();AjaxFlashMessage.initSettings();AjaxFlashMessage.registerGlobalAjaxComplete();$(document).off("MainAppScripts:update.AjaxFlashMessage").on("MainAppScripts:update.AjaxFlashMessage",function(){AjaxFlashMessage.ajaxFlashMessage()})});