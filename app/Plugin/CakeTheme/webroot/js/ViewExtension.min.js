(function(a,b){if(typeof define==="function"&&define.amd){define(b)}else{if(typeof exports==="object"){module.exports=b()}else{a.ViewExtension=b()}}})(this,function(){var c={};var e=10;function d(j,k){var m=j.length;for(var l=0;l<m;l++){if(j[l]===k){return true}}return false}function h(k){var j=[];var m=k.length;for(var l=0;l<m;l++){if(!d(j,k[l])){j.push(k[l])}}return j}function a(){return e}function g(m){var n=m.attr("type");var j="";switch(n){case"radio":case"checkbox":var p=m.is(":checked");if(!p){return j}j=m.val();break;case"hidden":j="";break;default:var k=m.prop("tagName").toLowerCase();switch(k){case"select":var l=m.children("option:selected");var o=null;var i=[];var q=null;$.each(l,function(r,s){q=$(s);o=q.val();if(o){i.push(q.text())}});if(i.length>0){j=i.join(", ")}break;case"input":j=m.val();break;default:j="";break}break}return j}function b(){var s="";var l=$(".filter-form :input:not(.filter-condition)");if(l.length===0){return s}var q=[];var o=null;var z=null;var m=null;var y="";var p=null;var u=null;var k=null;var w=null;var r=null;var x=null;var t=false;var i=[];var v=[];var n=a();var j=null;$.each(l,function(A,D){y="";o=$(D);z=o.attr("name");if(!z){return true}m=o.prop("tagName").toLowerCase();if(((z.length>2)&&(z.substr(-2)==="[]"))||((m==="select")&&(o.prop("multiple")))){t=true}i=[];if(t){if($.inArray(z,v)!==-1){return true}j=$('.filter-form :input[name="'+z+'"]');$.each(j,function(E,G){var F=$(G);var H=g(F);if(H){if(i.length>n){return true}else{if(i.length===n){i.push("...");return true}else{i.push(H)}}}});i=h(i);var C=i.join(", ");if(C){y="[ "+C+" ]"}v.push(z)}else{y=g(o)}if(!y){return true}u="=";w=o.parents(".form-group").find("button.btn-filter-condition").text();if(w){u=w}r=o.data("filter-label");if(r){k=r}else{var B=o.parents("th").index();if(B===-1){B=o.parents("td").index()}if(B!==-1){r=o.parents("table").find("thead > tr:eq(0) > th:eq("+B+")").text();if(r){k=r}}}if(o.attr("data-toggle")==="autocomplete"){y="*"+y+"*"}q.push(k+" "+$.trim(u)+" "+y)});x=$('[name="data[FilterCond][group]"]:first').parents(".btn-group").children('button[data-toggle="dropdown"]').text();if(!x){x="&&"}x=" "+$.trim(x)+" ";q=h(q);s=q.join(x);return s}function f(j){if(!j){return}var i=j.find('input.filter-condition[type="radio"][value=""]');if(i.length===0){return}i.trigger("click")}c.updateFilterForm=function(){var i=$("form.filter-form");if(i.length===0){return true}i.off("reset.ViewExtension").on("reset.ViewExtension",function(l){var k=$(this);k.clearForm();$("select",this).val("");$('[data-toggle="select"]',this).selectpicker("refresh");var j=k.data("toggle");if(j==="ajax-form"){if(!jQuery.fn.ajaxSubmit){return true}}else{if(j==="pjax-form"){if(!jQuery.fn.pjax||!jQuery.support.pjax){return true}}}k.trigger("submit");return false});return true};c.updateCloneFilterRow=function(){if(!jQuery.fn.cloneya){return false}var i=($('[data-toggle="clone-target"],.clone-wrapper'));if(i.length===0){return true}i.off("after_append.cloneya.ViewExtension").on("after_append.cloneya.ViewExtension",function(k,l,j){f(j)}).off("after_delete.cloneya.ViewExtension").on("after_delete.cloneya.ViewExtension",function(k,l,j){c.setConditiosText()});return true};c.setConditiosText=function(){var k=$('[data-toggle="filter-conditions"]');if(k.length===0){return false}var j=b();if(!j){j=k.data("empty-text")}var i=k.html();if(j!==i){k.html(j)}return true};c.updateFilterInput=function(){$(".filter-form :input").off("keydown.ViewExtension").on("keydown.ViewExtension",function(i){c.setConditiosText()});$(".filter-form :input").off("paste.ViewExtension").on("paste.ViewExtension",function(i){c.setConditiosText()});$(".filter-form :input").off("input.ViewExtension").on("input.ViewExtension",function(i){c.setConditiosText()});$(".filter-form :input").off("blur.ViewExtension").on("blur.ViewExtension",function(i){c.setConditiosText()});$(".filter-form :input").off("change.ViewExtension").on("change.ViewExtension",function(i){setTimeout(function(){c.setConditiosText()},0)});$('.filter-form :input[data-toggle="datetimepicker"]').off("dp.change.ViewExtension").on("dp.change.ViewExtension",function(i){c.setConditiosText()})};c.updateSelectAllBtn=function(){$('[data-toggle="btn-action-select-all"]').off("click.ViewExtension").on("click.ViewExtension",function(j){j.preventDefault();var i=$(this).data("select-state");if(typeof i==="undefined"){i=true}$(this).data("select-state",!i);$(".filter-form tr [type=checkbox]").prop("checked",i).trigger("change")})};c.updateGroupActionBtn=function(){$('.filter-form button[name="data[FilterAction]"][value="group-action"]').off("click.ViewExtension").on("click.ViewExtension",function(n){n.preventDefault();var p=$(this).data("dialog-title");var l=$(this).data("dialog-btn-ok");var t=$(this).data("dialog-btn-cancel");var r=$(this).data("dialog-sel-placeholder");var k=$(this).data("dialog-sel-options");if(!p){p="Select"}if((typeof k!=="object")||(k.length===0)){$(this).prop("disabled",true);return false}if(typeof Noty!=="undefined"){var i=new Noty({text:"",closeWith:["button"],force:true,modal:true,layout:"center",theme:"bootstrap-v3",type:"alert",buttons:[Noty.button(l,"btn btn-warning",function(){var u=$("div.noty_body #selectTaskInputDialog").val();i.close();if(u){$('.filter-form input[name="data[FilterGroup][action]"]').val(u);$(n.target).trigger("submit")}},{id:"buttonOk","data-status":"ok"}),Noty.button(t,"btn btn-default",function(){i.close()},{id:"buttonCancel","data-status":"cancel"})],callbacks:{beforeShow:function(){var u=$('<select id="selectTaskInputDialog" data-toggle="select"/>');$("<option />",{value:"",text:r}).appendTo(u);$(k).each(function(){$("<option />",{value:this.value,text:this.text}).appendTo(u)});var v=$('<div class="form-group" />').append('<label for="selectTaskInputDialog" class="control-label">'+r+"</label>");v.append(u);this.setText(v.html(),true)},onShow:function(){$("div.noty_buttons #buttonCancel",$(this.barDom)).focus();var u=$("#selectTaskInputDialog",$(this.barDom));u.off("change.ViewExtension").on("change.ViewExtension",function(w){var v=true;if($(this).val()){v=false}$(this).parents("div.noty_bar").find("div.noty_buttons #buttonOk").prop("disabled",v)});u.trigger("change");if(typeof MainAppScripts!=="undefined"){MainAppScripts.updateSelect()}},onTemplate:function(){$("div.noty_buttons",$(this.barDom)).addClass("text-center").css("border-top","1px solid #e7e7e7");$("div.noty_buttons button",$(this.barDom)).css("margin","0 2px");$(this.barDom).css("overflow","visible")}}}).show()}else{if(typeof bootbox!=="undefined"){var q=$("html").attr("lang");if(!q){q="en"}bootbox.setLocale(q);var o=bootbox.prompt({size:"small",title:p,buttons:{cancel:{label:t,className:"btn-default"},confirm:{label:l,className:"btn-warning"}},inputType:"select",inputOptions:k,callback:function(u){if(!u){return}$('.filter-form input[name="data[FilterGroup][action]"]').val(u);$(n.target).trigger("submit")}});o.init(function(){var u=$(".modal-body .bootbox-input-select");if(u.length===0){return}u.off("change.ViewExtension").on("change.ViewExtension",function(w){var v=true;if($(this).val()){v=false}$('.modal-footer button[data-bb-handler="confirm"]').prop("disabled",v)});u.trigger("change");if(typeof MainAppScripts!=="undefined"){MainAppScripts.updateSelect()}})}else{var m="";$.each(k,function(v,u){if(m){m+=" "}m+=(v+1)+". "+u.text+" - "+u.value+"."});p+=" ["+m+"]";var j="";var s=0;do{j=prompt(p);s=parseInt(j,10);if(j===null){s=-1;break}else{if(isNaN(s)){continue}}s--;if(typeof k[s]!=="undefined"){break}}while(true);if(s>=0){$('.filter-form input[name="data[FilterGroup][action]"]').val(k[s].value);$(n.target).trigger("submit")}}}return false})};return c});$(function(){$(document).off("MainAppScripts:update.ViewExtension").on("MainAppScripts:update.ViewExtension",function(){ViewExtension.updateFilterForm();ViewExtension.updateCloneFilterRow();ViewExtension.updateFilterInput();ViewExtension.updateSelectAllBtn();ViewExtension.updateGroupActionBtn();ViewExtension.setConditiosText()})});